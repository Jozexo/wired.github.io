---
const {
  name = "José Hernández",
  subtitle = "Ingeniero de Sistemas | Ciberseguridad (Penetración) y Hacking Ético | Infraestructura y Redes | Desarrollador Full-Stack",
} = Astro.props as { name?: string; subtitle?: string };
import "../styles/components/hero.css";
---
<section id="identity" class="section section--compact">
  <div class="flex flex-col md:flex-row items-start md:items-center gap-8">
    <div>
      <h1 class="text-4xl md:text-5xl font-semibold mb-1 flex items-center gap-3 flex-wrap reveal-hero" style="--d:0;color:#d27389">
        <span class="hero-name glitch glitch-anim" data-text={name}>{name}</span>
        <span class="term-badge" data-term-typing>
          <span class="term-cmd"></span>
          <span class="term-cursor" aria-hidden="true"></span>
        </span>
      </h1>
      <p class="text-(--muted) max-w-3xl reveal-hero" style="--d:1">
        {subtitle}
      </p>
      <a
        href="#contact"
        aria-label="Ir a contacto"
        class="node node--compact contact-cta inline-flex items-center gap-3 mt-5 no-underline reveal-hero"
        style="--d:2"
      >
        <span class="contact-cta__label font-semibold tracking-wide">Contactame</span>
        <svg class="opacity-70" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <path d="M7 17L17 7"/>
          <path d="M7 7h10v10"/>
        </svg>
      </a>
    </div>
      <figure class="silhouette-hover translate-y-1 reveal-hero" style="--d:3; --silhouette-mask: url(img/lain-glich.gif);">
      <img
        src="img/lain-glich.gif"
        alt="Lain style ambient glitch"
        loading="lazy"
        class="w-[220px] md:w-60 aspect-square object-cover transition-shadow"
      />
      <figcaption class="absolute -bottom-2 left-2 text-[10px] tracking-wide uppercase text-(--muted) opacity-70 select-none">
      </figcaption>
    </figure>
  </div>
</section>

<script type="module" src="/src/scripts/term-badge.ts"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const root = document.getElementById('identity');
    if (!root) return;
    const items = root.querySelectorAll('.reveal-hero');
    const nameEl = root.querySelector('.hero-name');

    const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (prefersReduced) {
      items.forEach(i => i.classList.add('is-visible'));
      return;
    }

    const io = new IntersectionObserver((entries, obs) => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          e.target.classList.add('is-visible');
          obs.unobserve(e.target);
        }
      });
    }, { threshold: 0.2 });

    items.forEach(el => io.observe(el));

    // Trigger a short glitch burst once when the title first becomes visible
    const nameObserver = new IntersectionObserver((entries, obs) => {
      entries.forEach(e => {
        if (e.isIntersecting && nameEl) {
          nameEl.classList.add('glitch-lain');
          setTimeout(() => nameEl.classList.remove('glitch-lain'), 1200);
          obs.disconnect();
        }
      });
    }, { threshold: 0.6 });
    if (nameEl) nameObserver.observe(nameEl);
  });
  </script>
